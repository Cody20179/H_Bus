TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`%` TRIGGER trg_route_stations_after_insert\nAFTER INSERT ON bus_route_stations\nFOR EACH ROW\nBEGIN\n  UPDATE bus_routes_total\n  SET stop_count = (\n    SELECT COUNT(*) FROM bus_route_stations WHERE route_id = NEW.route_id\n  )\n  WHERE route_id = NEW.route_id;\n\n  UPDATE bus_routes_total\n  SET start_stop = (\n      SELECT stop_name FROM bus_route_stations\n      WHERE route_id = NEW.route_id\n      ORDER BY stop_order ASC LIMIT 1\n    ),\n    end_stop = (\n      SELECT stop_name FROM bus_route_stations\n      WHERE route_id = NEW.route_id\n      ORDER BY stop_order DESC LIMIT 1\n    )\n  WHERE route_id = NEW.route_id;\nEND' 'CREATE DEFINER=`root`@`%` TRIGGER trg_route_stations_after_update\nAFTER UPDATE ON bus_route_stations\nFOR EACH ROW\nBEGIN\n  IF OLD.route_id != NEW.route_id THEN\n    \n    UPDATE bus_routes_total\n    SET stop_count = (SELECT COUNT(*) FROM bus_route_stations WHERE route_id = OLD.route_id)\n    WHERE route_id = OLD.route_id;\n\n    UPDATE bus_routes_total\n    SET start_stop = (SELECT stop_name FROM bus_route_stations WHERE route_id = OLD.route_id ORDER BY stop_order ASC LIMIT 1),\n        end_stop   = (SELECT stop_name FROM bus_route_stations WHERE route_id = OLD.route_id ORDER BY stop_order DESC LIMIT 1)\n    WHERE route_id = OLD.route_id;\n\n    \n    UPDATE bus_routes_total\n    SET stop_count = (SELECT COUNT(*) FROM bus_route_stations WHERE route_id = NEW.route_id)\n    WHERE route_id = NEW.route_id;\n\n    UPDATE bus_routes_total\n    SET start_stop = (SELECT stop_name FROM bus_route_stations WHERE route_id = NEW.route_id ORDER BY stop_order ASC LIMIT 1),\n        end_stop   = (SELECT stop_name FROM bus_route_stations WHERE route_id = NEW.route_id ORDER BY stop_order DESC LIMIT 1)\n    WHERE route_id = NEW.route_id;\n  ELSE\n    \n    UPDATE bus_routes_total\n    SET stop_count = (SELECT COUNT(*) FROM bus_route_stations WHERE route_id = NEW.route_id)\n    WHERE route_id = NEW.route_id;\n\n    UPDATE bus_routes_total\n    SET start_stop = (SELECT stop_name FROM bus_route_stations WHERE route_id = NEW.route_id ORDER BY stop_order ASC LIMIT 1),\n        end_stop   = (SELECT stop_name FROM bus_route_stations WHERE route_id = NEW.route_id ORDER BY stop_order DESC LIMIT 1)\n    WHERE route_id = NEW.route_id;\n  END IF;\nEND' 'CREATE DEFINER=`root`@`%` TRIGGER trg_route_stations_after_delete\nAFTER DELETE ON bus_route_stations\nFOR EACH ROW\nBEGIN\n  UPDATE bus_routes_total\n  SET stop_count = (\n    SELECT COUNT(*) FROM bus_route_stations WHERE route_id = OLD.route_id\n  )\n  WHERE route_id = OLD.route_id;\n\n  UPDATE bus_routes_total\n  SET start_stop = (\n      SELECT stop_name FROM bus_route_stations\n      WHERE route_id = OLD.route_id\n      ORDER BY stop_order ASC LIMIT 1\n    ),\n    end_stop = (\n      SELECT stop_name FROM bus_route_stations\n      WHERE route_id = OLD.route_id\n      ORDER BY stop_order DESC LIMIT 1\n    )\n  WHERE route_id = OLD.route_id;\nEND'
sql_modes=1436549152 1436549152 1436549152
definers='root@%' 'root@%' 'root@%'
client_cs_names='utf8mb4' 'utf8mb4' 'utf8mb4'
connection_cl_names='utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci'
db_cl_names='utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci'
created=1760685871269553 1760685871494467 1760685871902334
